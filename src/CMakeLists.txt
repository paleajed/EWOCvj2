cmake_minimum_required(VERSION 3.17)
project(EWOCvj2)

set(CMAKE_CXX_STANDARD 20)
if (UNIX)
    set(CMAKE_INSTALL_PREFIX /usr)
endif (UNIX)
if (!MSVC)
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -O0")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O0")
endif (!MSVC)

add_executable(EWOCvj2
        bins.cpp
        bins.h
        box.h
        effect.h
        layer.h
        loopstation.cpp
        loopstation.h
        mixer.cpp
        node.cpp
        node.h
        osc.cpp
        program.cpp
        program.h
        start.cpp
        tinyfiledialogs.c
        tinyfiledialogs.h
        window.h
        RtMidi.cpp)

include_directories(.)

if (WIN32)
    include_directories(C:/source/include)
    if (MINGW)
        include_directories(C:/msys64/mingw64/include)
        include_directories(C:/msys64/mingw64/x86_64-w64-mingw32/include)
    endif (MINGW)
    if (MSVC)
        link_directories(C:/source/boost_1_73_0/lib64-msvc-14.2)
    endif (MSVC)
endif (WIN32)
if (UNIX)
    include_directories(/usr/include/rtmidi)
    include_directories(/usr/include/libjpeg-turbo)
    include_directories(/usr/include/freetype2)
endif (UNIX)

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG ${CMAKE_BINARY_DIR}/debug)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE ${CMAKE_BINARY_DIR}/release)

#set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} /NODEFAULTLIB")

if (WIN32)
    if (MSVC)
        find_package( Boost 1.73.0 REQUIRED COMPONENTS filesystem HINTS C:/source/lib/cmake/Boost-1.73.0)
        target_link_libraries(EWOCvj2 PUBLIC ${Boost_FILESYSTEM_LIBRARY})
    endif (MSVC)
    if (MINGW)
        find_library(BOOSTFS_LIBRARY libboost_filesystem-mt.a HINTS C:/source/lib C:/msys64/mingw64/lib)
        target_link_libraries(EWOCvj2 PUBLIC ${BOOSTFS_LIBRARY})
        find_library(BOOSTSYS_LIBRARY libboost_system-mt.a HINTS C:/source/lib C:/msys64/mingw64/lib)
        target_link_libraries(EWOCvj2 PUBLIC ${BOOSTSYS_LIBRARY})
    endif (MINGW)
    find_library(AVCODEC_LIBRARY avcodec HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${AVCODEC_LIBRARY})
    find_library(AVDEVICE_LIBRARY avdevice HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${AVDEVICE_LIBRARY})
    find_library(AVFORMAT_LIBRARY avformat HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${AVFORMAT_LIBRARY})
    find_library(AVUTIL_LIBRARY avutil HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${AVUTIL_LIBRARY})
    find_library(SWSCALE_LIBRARY swscale HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${SWSCALE_LIBRARY})
    find_library(SWRESAMPLE_LIBRARY swresample HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${SWRESAMPLE_LIBRARY})
    find_library(AVFILTER_LIBRARY avfilter HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${AVFILTER_LIBRARY})

    find_library(DEVIL_LIBRARY DevIL HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${DEVIL_LIBRARY})
    find_library(FREEGLUT_LIBRARY freeglut HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${FREEGLUT_LIBRARY})
    find_library(FREETYPE_LIBRARY freetype HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${FREETYPE_LIBRARY})
    find_library(GLEW32_LIBRARY glew32 HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${GLEW32_LIBRARY})
    find_library(LO_LIBRARY lo HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${LO_LIBRARY})
    find_library(OPENAL32_LIBRARY OpenAL32 HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${OPENAL32_LIBRARY})
    find_library(SDL2_LIBRARY SDL2 HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${SDL2_LIBRARY})
    find_library(SNAPPY_LIBRARY snappy HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${SNAPPY_LIBRARY})
    find_library(TJPEG_LIBRARY turbojpeg HINTS /opt/libjpeg-turbo/lib64 C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${TJPEG_LIBRARY})
    find_library(RTMIDI_LIBRARY rtmidi HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC optimized ${RTMIDI_LIBRARY})
endif (WIN32)

if (UNIX)
    find_library(BOOSTFS_LIBRARY boost_filesystem HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC optimized ${BOOSTFS_LIBRARY})
    find_library(BOOSTFSD_LIBRARY boost_filesystem HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC debug ${BOOSTFSD_LIBRARY})
    find_library(AVCODEC_LIBRARY avcodec HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${AVCODEC_LIBRARY})
    find_library(AVDEVICE_LIBRARY avdevice HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${AVDEVICE_LIBRARY})
    find_library(AVFORMAT_LIBRARY avformat HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${AVFORMAT_LIBRARY})
    find_library(AVUTIL_LIBRARY avutil HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${AVUTIL_LIBRARY})
    find_library(SWSCALE_LIBRARY swscale HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${SWSCALE_LIBRARY})
    find_library(SWRESAMPLE_LIBRARY swresample HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${SWRESAMPLE_LIBRARY})
    find_library(AVFILTER_LIBRARY avfilter HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${AVFILTER_LIBRARY})

    find_library(DEVIL_LIBRARY IL HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${DEVIL_LIBRARY})
    find_library(FREEGLUT_LIBRARY glut HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${FREEGLUT_LIBRARY})
    find_library(FREETYPE_LIBRARY freetype HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${FREETYPE_LIBRARY})
    find_library(GLEW32_LIBRARY GLEW HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${GLEW32_LIBRARY})
    find_library(LO_LIBRARY lo HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${LO_LIBRARY})
    find_library(OPENAL32_LIBRARY openal HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${OPENAL32_LIBRARY})
    find_library(SDL2_LIBRARY SDL2 HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${SDL2_LIBRARY})
    find_library(SNAPPY_LIBRARY snappy HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${SNAPPY_LIBRARY})
    find_library(TJPEG_LIBRARY turbojpeg HINTS /opt/libjpeg-turbo/lib64 /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC ${TJPEG_LIBRARY})
    find_library(RTMIDI_LIBRARY rtmidi HINTS /usr/lib /usr/lib64 /usr/local/lib /usr/local/lib64)
    target_link_libraries(EWOCvj2 PUBLIC optimized ${RTMIDI_LIBRARY})
endif (UNIX)

if (WIN32)
    find_library(RTMIDID_LIBRARY rtmidid HINTS C:/source/lib C:/msys64/mingw64/lib)
    target_link_libraries(EWOCvj2 PUBLIC debug ${RTMIDID_LIBRARY})
    find_library(WINMM_LIBRARY winmm HINTS C:/source/lib C:/msys64/mingw64/x86_64-w64-mingw32/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${WINMM_LIBRARY})
    find_library(SHCORE_LIBRARY shcore HINTS C:/source/lib C:/msys64/mingw64/x86_64-w64-mingw32/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${SHCORE_LIBRARY})
    find_library(WS2_LIBRARY ws2_32 HINTS C:/source/lib C:/msys64/mingw64/x86_64-w64-mingw32/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${WS2_LIBRARY})
endif (WIN32)
if (MSVC)
    find_library(SHCORE_LIBRARY shcore HINTS C:/source/lib C:/msys64/mingw64/x86_64-w64-mingw32/lib)
    target_link_libraries(EWOCvj2 PUBLIC ${SHCORE_LIBRARY})
    find_library(LSTDIO_LIBRARY legacy_stdio_definitions HINTS)
    target_link_libraries(EWOCvj2 PUBLIC ${LSTDIO_LIBRARY})
endif (MSVC)
if (MINGW)
    find_library(OPENGL_LIBRARY opengl32 HINTS C:/source/lib C:/msys64/mingw64/x86_64-w64-mingw32/lib)
    target_link_libraries(EWOCvj2 PUBLIC debug ${OPENGL_LIBRARY})
endif (MINGW)

if (UNIX)
    find_library(PTHREAD_LIBRARY pthread HINTS)
    target_link_libraries(EWOCvj2 PUBLIC ${PTHREAD_LIBRARY})
    find_library(X11_LIBRARY X11 HINTS)
    target_link_libraries(EWOCvj2 PUBLIC ${X11_LIBRARY})
    find_library(GL_LIBRARY GL HINTS)
    target_link_libraries(EWOCvj2 PUBLIC ${GL_LIBRARY})
    find_library(Z_LIBRARY z HINTS)
    target_link_libraries(EWOCvj2 PUBLIC ${Z_LIBRARY})
endif (UNIX)


if (UNIX)
    install(TARGETS EWOCvj2 RUNTIME DESTINATION bin)
    install(FILES ewocvj2-*.xml DESTINATION share/mime)
    install(DIRECTORY DESTINATION share/ewocvj2)
    install(FILES shader.* DESTINATION share/ewocvj2)
    install(FILES background.jpg DESTINATION share/ewocvj2)
endif (UNIX)
